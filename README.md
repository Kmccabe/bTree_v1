# bTree v1 ‚Äî Trust Game MVP (Algorand + Pera/TestNet)Minimal, production‚Äëoriented scaffold for running a Trust Game on Algorand TestNet. The app is built with React + Vite, uses Pera Wallet for signing, and deploys on Vercel with serverless routes that proxy Algod.- Wallet: Pera (TestNet; no mnemonics in‚Äëbrowser)- Chain access: Vercel serverless functions ‚Üí Algod- Hosting: Vercel (Root Directory = `frontend/`)- Contracts: Placeholder TEAL for now; upgradeable to full Trust Game logic## Trust Game (MVP)- üìÑ Design spec: [frontend/docs/trust-game-design.md](frontend/docs/trust-game-design.md)- üß™ Variants & treatments: [frontend/docs/trust-game-variants.md](frontend/docs/trust-game-variants.md)- Testing checklist (Phase 2): [frontend/docs/phase-2-testing.md](frontend/docs/phase-2-testing.md)**Quick note:** The app lives under `frontend/` (React + Vite + Vercel serverless). Admin can deploy & fund a per-pair contract from the in-app ‚ÄúAdmin ‚Äî Deploy & Fund‚Äù panel.---## Update: Wallet Integration (use-wallet v2)The frontend now uses `@txnlab/use-wallet` v2 with the Pera provider and UI improvements:- Provider init lives in `frontend/src/main.tsx` using `useInitializeProviders` and `<WalletProvider>`.- No forced chainId; make sure Pera‚Äôs network matches `VITE_NETWORK`.- Optional auto‚Äërestore on load via `VITE_WALLET_AUTO_RECONNECT=true` (default: disabled).- Account selector appears when multiple accounts are available (`frontend/src/components/AccountSelector.tsx`).- Non‚Äëblocking toasts replace browser alerts (`frontend/src/components/Toaster.tsx`).- The Debug Panel includes ‚ÄúForce Reconnect‚Äù and ‚ÄúReset Wallet Session‚Äù actions for recovery.Note: This supersedes earlier mentions of a shared `src/wallet.ts` Pera instance; the app now relies on `@txnlab/use-wallet` hooks and provider.---## Quick StartLocal (with serverless APIs):1) Install deps```cd frontendnpm install```2) Create `frontend/.env` for serverless routes (Algonode needs no token)```TESTNET_ALGOD_URL=https://testnet-api.algonode.cloudTESTNET_ALGOD_TOKEN=```3) Run serverless and UI in two terminals```# Terminal A (serverless):npx vercel dev# Terminal B (Vite UI):npm run dev```4) Open http://localhost:5173, connect Pera (TestNet), click Deploy, then use Phase Control.Deploy to Vercel (summary):- Root Directory: `frontend/`- Build Command: `npm run build`- Output Directory: `dist`- Env vars: set TESTNET_ALGOD_URL/TESTNET_ALGOD_TOKEN (serverless) and optional VITE_* (client)---## Project Structure```contracts/                      # PyTeal scaffold + build script (optional now)  build.py  requirements.txtfrontend/                       # React + Vite + TypeScript app (Pera on TestNet)  api/                          # Serverless routes (Algod proxy)    _algod.ts                   # URL + headers helper    params.ts                   # GET  /api/params    compile.ts                  # POST /api/compile    submit.ts                   # POST /api/submit    pending.ts                  # GET  /api/pending?txid=...  public/    favicon.svg  src/    App.tsx                     # Pera connect, deploy, debug panel    main.tsx                    # use-wallet v2 provider initialization    deploy.ts                   # Build unsigned app-create txn (wallet signs)    components/PhaseControl.tsx # Admin phase switching via app call    polyfills.ts                # Buffer/process/global shims for browser  index.html  package.json```---## Prerequisites- Node.js 18+ and npm- Vercel CLI (optional, for local serverless): `npm i -g vercel`- Pera Wallet (Developer Mode + TestNet enabled, funded TestNet account)Optional (for contracts/tests):- Python 3.10+- Docker + AlgoKit for LocalNet---## Environment VariablesSet these in Vercel ‚Üí Project ‚Üí Settings ‚Üí Environment Variables for Production/Preview/Development (serverless), and in `frontend/.env.local` for local client build.Serverless (used by `/api/*`, stored securely in Vercel):```TESTNET_ALGOD_URL   = https://testnet-api.algonode.cloudTESTNET_ALGOD_TOKEN =            # blank for Algonode, or your provider key```Client (Vite build‚Äëtime, safe to expose):```VITE_NETWORK              = TESTNETVITE_TESTNET_APP_ID       =            # optional; shows a known app idVITE_TESTNET_ALGOD_URL    = https://testnet-api.algonode.cloudVITE_TESTNET_INDEXER_URL  = https://testnet-idx.algonode.cloud```Local serverless (only for `vercel dev`):```# frontend/.envTESTNET_ALGOD_URL=https://testnet-api.algonode.cloudTESTNET_ALGOD_TOKEN=```---## Local Development1) Install and run the frontend```cd frontendnpm installnpm run dev         # Vite UI at http://localhost:5173```2) (Optional) Run serverless API routes locally```cd frontendnpx vercel dev      # http://localhost:3000 (includes /api/*)```When both are running, Vite proxies `/api/*` to Vercel dev.---## Deploying to VercelProject settings:- Root Directory: `frontend/`- Build Command: `npm run build`- Output Directory: `dist`- Node.js: 18+- Environment Variables: set the Serverless and Client values aboveFirst deploy:1) Push to your Git host and import the repo into Vercel.2) Confirm the Root Directory and env vars.3) Deploy and visit the site.Post‚Äëdeploy health checks:- `https://<your-app>/api/health` ‚Üí `{ ok: true }`- `https://<your-app>/api/params` ‚Üí JSON with `"last-round"`---## Using the App1) Connect Pera Wallet (ensure the wallet is on TestNet).2) Deploy placeholder app (creates a minimal TEAL app on TestNet via wallet‚Äësigned transaction).3) Use Phase Control to switch experiment phases (NoOp application calls).Notes:- Transactions are built client‚Äëside and signed in Pera; serverless routes only forward the signed bytes to Algod.- Wallet integration uses `@txnlab/use-wallet` v2; no shared `wallet.ts` singleton. Provider setup lives in `frontend/src/main.tsx`.---## Refactor Highlights- Moved to `@txnlab/use-wallet` v2 (Pera provider) with initialization in `frontend/src/main.tsx`.- Removed legacy wallet singleton (`src/wallet.ts`) and legacy identity modules.- Enforced serverless-only chain I/O via `frontend/api/*` (no direct Algod from the browser).- Clarified env separation: `TESTNET_ALGOD_*` (server) vs `VITE_*` (client).- Local dev uses `vercel dev` with Vite proxying `/api` to `:3000`.---## API Routes- `GET  /api/health`      ‚Äì basic health check- `GET  /api/params`      ‚Äì fetch Algod suggested params- `POST /api/compile`     ‚Äì compile TEAL source- `POST /api/submit`      ‚Äì submit a signed transaction (base64)- `GET  /api/pending`     ‚Äì pending info for a txid---## Implementation Details- SuggestedParams normalization (SDK v3‚Äëfriendly):  - `fee`/`minFee` (‚â• 1000), `flatFee: true`  - `firstValid`/`lastValid` and `firstRound`/`lastRound` aliases  - `genesisID` and base64‚Äëdecoded `genesisHash`- Polyfills for browser builds (`Buffer`, `process`, `global`) are provided in `src/polyfills.ts`.- `frontend/public/favicon.svg` is included; `/favicon.ico` redirects to it via `vercel.json`.---## Troubleshooting- Wallet connection issues:  - Ensure Pera is on the same network as `VITE_NETWORK` (TestNet by default).  - Use the Debug Panel actions (Reconnect/Reset) or call `reconnectProviders` via the app to restore sessions.- Zero‚Äëfee rejection ("txgroup had 0 in fees"):  - Params are normalized to enforce a non‚Äëzero fee; refresh and retry.- `/api/*` returns HTML/404 locally:  - Run `npx vercel dev` alongside `npm run dev` so `/api` is routed.- Vercel deploys not triggered on push:  - Set Root Directory = `frontend/`, resync the Git integration, or create a blank commit:    - `git commit --allow-empty -m "chore: trigger deploy" && git push`---## Roadmap- Replace placeholder TEAL with full Trust Game contract- Registration, pairing, commit/reveal, settlement flows- CSV export and integrity digest- LocalNet + CI test coverage
# bTree v1 ÔøΩ?" Trust Game MVP (Algorand + Pera/TestNet)Minimal, productionÔøΩ?`oriented scaffold for running a Trust Game on Algorand TestNet. The app is built with React + Vite, uses Pera Wallet for signing, and deploys on Vercel with serverless routes that proxy Algod.- Wallet: Pera (TestNet; no mnemonics inÔøΩ?`browser)- Chain access: Vercel serverless functions ÔøΩ+' Algod- Hosting: Vercel (Root Directory = `frontend/`)- Contracts: Placeholder TEAL for now; upgradeable to full Trust Game logic## Trust Game (MVP)- dY", Design spec: [frontend/docs/trust-game-design.md](frontend/docs/trust-game-design.md)- dY\u0015ÔøΩ Variants & treatments: [frontend/docs/trust-game-variants.md](frontend/docs/trust-game-variants.md)- Testing checklist (Phase 2): [frontend/docs/phase-2-testing.md](frontend/docs/phase-2
## Quick Demo (single account)

Run the end-to-end Phase 2 flow with one wallet (TestNet):

1) Connect Wallet: ensure the wallet is on TestNet.
2) Deploy contract (or use an existing App ID): use the Admin panel to Deploy, or use an existing App ID.
3) Fund the contract: send funds to the App Address. For a full demo in one pass, the app needs at least t = 3 √ó s microAlgos after Invest (the UI also shows low-balance hints; baseline is ~0.20 ALGO).
4) Set App ID in the Subject panel: in ‚ÄúSubject - Invest‚Äù, enter the App ID and click ‚ÄúLoad globals‚Äù.
5) Opt-In: in ‚ÄúSubject - Return‚Äù, click ‚ÄúOpt-In‚Äù (safe to ignore the ‚Äúalready opted in‚Äù error if shown).
6) Open Quick Demo: in the Subject panel, find ‚ÄúQuick Demo (single account)‚Äù.
7) Enter inputs:
   - s (microAlgos): multiple of UNIT and <= E (example: 40000 if UNIT=1000).
   - r (microAlgos): 0..t and multiple of UNIT (t becomes 3 √ó s after Invest).
8) Click ‚ÄúRun Demo‚Äù: the app will [set phase=2 if you are creator] ‚Üí Opt-In ‚Üí Invest ‚Üí Read Pair States ‚Üí check funding ‚Üí Return.
   - If underfunded for Return, fund the App Address (QR is shown) and use ‚ÄúRun Return only‚Äù.
9) View results on LoRA: after confirmation, ‚ÄúInvest‚Äù and ‚ÄúReturn‚Äù links appear; they open lora.algokit.io/testnet/tx/<txid> with the outer app call and inner payments.
